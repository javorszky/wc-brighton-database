<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>"Things you didn't know you need to know about WordPress and databases" talk by Gabor Javorszky – WordCamp Brighton, 18th August 2017</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Things you didn't know you need to know about WordPress and databases</h2>

					<p class="fragment">crash course into database architecture</p>
					<aside class="notes">
						<p><small>(full disclosure: I'm not a certified DB architect)</small></p>
					</aside>
				</section>

				<section>
					<h1>Assumptions</h1>
					<ol>
						<li>
							<p>Site is large with lots of data</p>
						</li>
						<li>
							<p>potentially one with WooCommerce</p>
						</li>
					</ol>
				</section>

				<section>
					<h2>common (slow) queries</h2>
					<blockquote>get me all the orders for user 4</blockquote>
					<blockquote>get me all subscriptions where the next payment date is between X and Y</blockquote>
					<blockquote>get me all orders where the total is $19.92</blockquote>
					<blockquote>get me the sum of all order totals where the order date is in May and order by order total. or date</blockquote>
				</section>

				<section>
					<blockquote>basically doing anything on the admin area</blockquote>
				</section>

				<section>
					<p>All of those are going to be</p>
					<p class="fragment">...really...</p>
					<p class="fragment">...slow.</p>
				</section>

				<section>
					<h1>The Talk</h1>
					<ul>
						<li>indexes and how to use them</li>
						<li>storing data in multiple tables vs one table - foreign keys and why they're awesome</li>
						<li>tools to measure stuff</li>
					</ul>
					<aside class="notes">
						<p>Can I help existing sites? - probably not</p>
						<p>Can I help you build better plugins / themes? - hope so</p>
					</aside>
				</section>

				<!-- indexes part -->
				<section>
					<h1>Indexes</h1>
					<p>What are they?</p>
					<p>Why are they important?</p>
					<p>How do they work?</p>
					<p>Indexable, unindexable (looking at you, postmeta value!)</p>
				</section>

				<section>
					<h1>What are indexes</h1>
				</section>

				<section>
					<img src="assets/pix/j-zamora-267753.jpg" alt="library">
					<a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px;" href="https://unsplash.com/@jzamora?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from j zamora"><span style="display:inline-block;padding:2px 3px;"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white;" viewBox="0 0 32 32"><title></title><path d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"></path></svg></span><span style="display:inline-block;padding:2px 3px;">j zamora</span></a>
				</section>

				<section>
					<img src="assets/pix/sanwal-deen-93466.jpg" alt="library index">
					<a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px;" href="https://unsplash.com/@sanwaldeen?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Sanwal Deen"><span style="display:inline-block;padding:2px 3px;"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white;" viewBox="0 0 32 32"><title></title><path d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"></path></svg></span><span style="display:inline-block;padding:2px 3px;">Sanwal Deen</span></a>
				</section>

				<section>
					<h2>How do indexes work?</h2>
					<p>From <a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-indexes.html">MySQL documentation on indexes</a></p>
					<blockquote cite="https://dev.mysql.com/doc/refman/5.7/en/mysql-indexes.html">Indexes are used to find rows with specific column values quickly. Without an index, MySQL must begin with the first row and then read through the entire table to find the relevant rows. The larger the table, the more this costs. If the table has an index for the columns in question, MySQL can quickly determine the position to seek to in the middle of the data file without having to look at all the data. This is much faster than reading every row sequentially.</blockquote>
					<aside class="notes">
						<p>Extra data stored in the same physical file as the InnoDB tables. Indexes are table specific.</p>
					</aside>
				</section>

				<section>
					<h2>Why are they important?</h2>
					<p>In short: well designed indexes will get you the data in a fast, efficient manner.</p>
					<p>You can do more on the same hardware => cheaper hosting => faster site => happier customers => more income / profit</p>
				</section>

				<section>
					<h2>Columns, data types</h2>
					<ul>
						<li>numeric: INTEGER, BIGINT, SIGNED / UNSIGNED</li>
						<li>string: TEXT, VARCHAR, LONGTEXT</li>
						<li>date type: DATE, TIMESTAMP, DATETIME</li>
						<li>specifying character lengths: VARCHAR(191), BIGINT(20)</li>
					</ul>
					<div class="fragment">
						<p>Examples of signed / unsigned. "Can it have a negative sign?". Highest binary place is the sign</p>
						<pre><code class="php" data-trim>
							// signed -127 – +127
							000101011 = +43
							100101011 = -43

							// unsigned 0 – 255
							000101011 = 43
							100101011 = 171
						</code></pre>
					</div>
				</section>

				<section>
					<h1>What / how should be indexed?</h1>
					<p>From <a href="https://dev.mysql.com/doc/refman/5.7/en/optimization-indexes.html">MySQL documentation on optimization and indexes</a></p>
					<blockquote cite="https://dev.mysql.com/doc/refman/5.7/en/optimization-indexes.html">Although it can be tempting to create an indexes for every possible column used in a query, unnecessary indexes waste space and waste time for MySQL to determine which indexes to use. Indexes also add to the cost of inserts, updates, and deletes because each index must be updated. You must find the right balance to achieve fast queries using the optimal set of indexes.</blockquote>
				</section>

				<section>
					<h2>Unique / multi index</h2>
					<p><strong>UNIQUE:</strong> one value can only appear once in a row. Trying to insert same value will result in a database error message. Super fast <br><em>Example: post IDs</em></p>
					<p><strong>Multi index: </strong>same value can repeat. Still fast, though additional filtering required. <br><em>Example: postmeta_key</em></p>
				</section>

				<section>
					<h2>NULL values in indexes</h2>
					<p>From <a href="https://dev.mysql.com/doc/refman/5.7/en/optimizing-innodb-queries.html">optimizing InnoDB queries</a></p>
					<blockquote cite="https://dev.mysql.com/doc/refman/5.7/en/optimizing-innodb-queries.html">If an indexed column cannot contain any NULL values, declare it as NOT NULL when you create the table. The optimizer can better determine which index is most effective to use for a query, when it knows whether each column contains NULL values.</blockquote>
					<p><strong>tldr;</strong> if it shouldn't be NULL, declare it so. It will be faster.</p>
				</section>

				<section>
					<h2>Compound indexes</h2>
					<pre><code class="php" data-trim data-noescape>
						// given these columns
						ID, post_name, post_date

						CREATE INDEX (ID, post_name, post_date)
						// will result in a compound index across ID, post_name, post_date, in that order
					</code></pre>
					<p>“If the table has a multiple-column index, any leftmost prefix of the index can be used by the optimizer to look up rows.”</p>
					<pre><code class="php" data-trim>
						// in this case
						SELECT * FROM table WHERE ID = x, post_name = y        // uses index (1,2)
						SELECT * FROM table WHERE ID = x                       // uses index (1)
						SELECT * FROM table WHERE ID = x, post_date = z        // NOT using index (1,3)
						SELECT * FROM table WHERE post_name = y, post_date = z // NOT using index (2,3)
						SELECT * FROM table WHERE post_name = y                // NOT using index (2)
					</code></pre>
				</section>

				<section>
					<h1>WP DB - posts</h1>
					<p><img src="assets/pix/posts.png" alt=""></p>
				</section>

				<section>
					<p>select statements indexing vs order by / group by optimization</p>
					How to make queries fast?

					Know how the optimizer works!

					Regarding NULLs


				</section>
				<section>


					<p>https://dev.mysql.com/doc/refman/5.7/en/mysql-indexes.html</p>
				</section>
				<section>
					<p>To retrieve rows from other tables when performing joins. MySQL can use indexes on columns more efficiently if they are declared as the same type and size. In this context, VARCHAR and CHAR are considered the same if they are declared as the same size. For example, VARCHAR(10) and CHAR(10) are the same size, but VARCHAR(10) and CHAR(15) are not.

					For comparisons between nonbinary string columns, both columns should use the same character set. For example, comparing a utf8 column with a latin1 column precludes use of an index.

					Comparison of dissimilar columns (comparing a string column to a temporal or numeric column, for example) may prevent use of indexes if values cannot be compared directly without conversion. For a given value such as 1 in the numeric column, it might compare equal to any number of values in the string column such as '1', ' 1', '00001', or '01.e1'. This rules out use of any indexes for the string column.</p>

					<p>https://dev.mysql.com/doc/refman/5.7/en/mysql-indexes.html</p>

					<p>MySQL can use multiple-column indexes for queries that test all the columns in the index, or queries that test just the first column, the first two columns, the first three columns, and so on. If you specify the columns in the right order in the index definition, a single composite index can speed up several kinds of queries on the same table.</p>
				</section>

				<section>
					<p>Indexes are less important for queries on small tables, or big tables where report queries process most or all of the rows. When a query needs to access most of the rows, reading sequentially is faster than working through an index. Sequential reads minimize disk seeks, even if not all the rows are needed for the query. See Section 8.2.1.19, “Avoiding Full Table Scans” for details.</p>
				</section>

				<section>
					<p>If the table has a multiple-column index, any leftmost prefix of the index can be used by the optimizer to look up rows. For example, if you have a three-column index on (col1, col2, col3), you have indexed search capabilities on (col1), (col1, col2), and (col1, col2, col3).</p>
				</section>

				<!-- Multiple tables part -->
				<section>
					<p>When to use existing / built in functionality to store data and when to create new tables.</p>
				</section>

				<section>
					<p>additionally when you create new tables, what should they look like?</p>
					<p>very much depends on your use case and how you're going to interact with the data</p>
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
